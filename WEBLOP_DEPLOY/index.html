<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WEBLOP</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Reverse Mode Warning Modal -->
    <div id="reverseWarningModal" class="warning-modal" style="display: none;">
        <div class="warning-modal-content">
            <div class="warning-icon">⚠️</div>
            <h2>Reverseモード警告</h2>
            <div class="warning-text">
                <p><strong>この動画でReverseモードを使用すると問題が発生する可能性があります：</strong></p>
                <ul>
                    <li>高解像度・高フレームレートの動画は<strong>メモリ不足</strong>で停止する場合があります</li>
                    <li>処理中にブラウザが<strong>固まる・クラッシュ</strong>する場合があります</li>
                </ul>
                <p class="warning-tip">💡 問題が起きる場合は「Forward」モードをお試しください</p>
            </div>
            <label class="warning-checkbox">
                <input type="checkbox" id="reverseWarningCheck">
                <span>上記の注意事項を理解しました</span>
            </label>
            <div class="warning-buttons">
                <button id="reverseWarningCancelBtn" class="btn warning-cancel-btn">キャンセル</button>
                <button id="reverseWarningProceedBtn" class="btn warning-proceed-btn" disabled>実行する</button>
            </div>
        </div>
    </div>

    <!-- Frame Cut Warning Modal -->
    <div id="frameCutWarningModal" class="warning-modal" style="display: none;">
        <div class="warning-modal-content">
            <div class="warning-icon">⚠️</div>
            <h2>フレームカットモード警告</h2>
            <div class="warning-text">
                <p><strong>この処理には以下の注意点があります：</strong></p>
                <ul>
                    <li>動画の長さや本数によって<strong>数時間</strong>かかる場合があります</li>
                    <li>処理中にブラウザが<strong>固まる・停止</strong>する場合があります</li>
                    <li>高解像度の動画は特に時間がかかります</li>
                </ul>
                <p class="warning-tip">💡 高速処理したい場合は「OFF」モードをお使いください</p>
            </div>
            <label class="warning-checkbox">
                <input type="checkbox" id="warningConfirmCheck">
                <span>上記の注意事項を理解しました</span>
            </label>
            <div class="warning-buttons">
                <button id="warningCancelBtn" class="btn warning-cancel-btn">キャンセル</button>
                <button id="warningProceedBtn" class="btn warning-proceed-btn" disabled>実行する</button>
            </div>
        </div>
    </div>

    <!-- FFmpeg Loading Overlay -->
    <div id="ffmpegLoading" class="loading-overlay">
        <div class="loading-content">
            <div class="spinner"></div>
            <p>FFmpeg.wasm を読み込み中...</p>
            <p class="loading-note">初回は約25MB のダウンロードが必要です</p>
        </div>
    </div>

    <div class="app">
        <header class="header">
            <h1><span id="titlePrefix">WEBLO</span><span id="lopO">OOO</span><span id="titleSuffix">P</span><span class="version">v2.4</span></h1>
            <div class="theme-switcher">
                <button id="themeDark" class="theme-btn active">Dark</button>
                <button id="themeDay" class="theme-btn">Day</button>
                <button id="themePink" class="theme-btn">WOW♥</button>
            </div>
        </header>

        <!-- モード切り替えタブ -->
        <div class="mode-tabs">
            <button id="tabLoop" class="mode-tab active">Loop</button>
            <button id="tabMerge" class="mode-tab">Merge</button>
        </div>

        <div class="main">
            <!-- ===== LOOP MODE ===== -->
            <div id="loopMode">
            <!-- ファイル選択セクション -->
            <div id="inputSection" class="input-section">
                <div id="dropZone" class="drop-zone">
                    <span class="icon">📁</span>
                    <span>動画をドラッグ&ドロップ</span>
                    <span class="drop-hint">または クリックして選択</span>
                </div>
                <input type="file" id="fileInput" accept="video/*" hidden>
            </div>

            <!-- 動画情報 -->
            <div id="videoInfo" class="video-info" style="display: none;">
                <div class="info-row">
                    <span class="label">ファイル:</span>
                    <span id="fileName" class="value"></span>
                </div>
                <div class="info-row">
                    <span class="label">長さ:</span>
                    <span id="videoDuration" class="value"></span>
                </div>
                <div class="info-row">
                    <span class="label">サイズ:</span>
                    <span id="fileSize" class="value"></span>
                </div>
                <div id="warningMessage" class="warning" style="display: none;"></div>
                <div class="preview-container">
                    <video id="previewVideo" class="preview" controls></video>
                </div>
                <button id="changeFileBtn" class="btn change-btn">別のファイルを選択</button>
            </div>

            <!-- コントロール -->
            <div id="controlsSection" class="controls" style="display: none;">
                <div class="control-group">
                    <label class="control-label">ループ回数</label>
                    <input type="number" id="loopCount" value="3" min="1" max="20" class="loop-input">
                </div>

                <div class="control-group">
                    <label class="control-label">再生モード</label>
                    <div class="loop-mode-switcher">
                        <button id="modeReverse" class="mode-btn active">Reverse</button>
                        <button id="modeForward" class="mode-btn">Forward</button>
                    </div>
                </div>

                <div id="totalInfo" class="total-info">
                    <span class="total-label">推定出力時間:</span>
                    <span id="totalDuration" class="total-value">-</span>
                </div>
            </div>

            <!-- 出力ボタン -->
            <div id="outputSection" class="output-section" style="display: none;">
                <button id="generateBtn" class="btn output-btn">
                    <span class="icon">🎬</span>
                    <span>ループ動画を生成</span>
                </button>
                <div class="output-note">
                    <span>※ 生成後にダウンロードできます</span>
                </div>
            </div>
            </div>
            <!-- ===== END LOOP MODE ===== -->

            <!-- ===== MERGE MODE ===== -->
            <div id="mergeMode" style="display: none;">
                <!-- 複数ファイル選択 -->
                <div id="mergeInputSection" class="input-section">
                    <div id="mergeDropZone" class="drop-zone">
                        <span class="icon">📁</span>
                        <span>複数の動画をドラッグ&ドロップ</span>
                        <span class="drop-hint">または クリックして選択</span>
                    </div>
                    <input type="file" id="mergeFileInput" accept="video/*" multiple hidden>
                </div>

                <!-- 動画リスト -->
                <div id="mergeVideoList" class="merge-video-list" style="display: none;">
                    <div class="list-header">
                        <span class="list-title">動画リスト</span>
                        <span class="list-count">(<span id="mergeVideoCount">0</span>本)</span>
                    </div>
                    <div id="mergeVideos" class="merge-videos"></div>
                    <button id="addMoreBtn" class="btn change-btn">+ 動画を追加</button>
                </div>

                <!-- Mergeコントロール -->
                <div id="mergeControlsSection" class="controls" style="display: none;">
                    <div class="control-group">
                        <label class="control-label">フレームカット</label>
                        <div class="quality-switcher">
                            <button id="frameCut0" class="quality-btn active">OFF</button>
                            <button id="frameCut1" class="quality-btn">1F</button>
                            <button id="frameCut2" class="quality-btn">2F</button>
                        </div>
                    </div>

                    <div id="mergeTotalInfo" class="total-info">
                        <span class="total-label">推定出力時間:</span>
                        <span id="mergeTotalDuration" class="total-value">-</span>
                    </div>
                </div>

                <!-- Merge出力ボタン -->
                <div id="mergeOutputSection" class="output-section" style="display: none;">
                    <button id="mergeGenerateBtn" class="btn output-btn">
                        <span class="icon">🎬</span>
                        <span>動画を結合</span>
                    </button>
                    <div class="output-note">
                        <span id="mergeNote">※ フレームカットOFFの場合、そのまま結合されます</span>
                    </div>
                </div>
            </div>
            <!-- ===== END MERGE MODE ===== -->

            <!-- 進捗表示 -->
            <div id="progress" class="progress" style="display: none;">
                <div class="progress-bar">
                    <div id="progressFill" class="progress-fill"></div>
                </div>
                <div class="progress-info">
                    <span id="progressText">0%</span>
                    <span id="progressLabel" class="progress-label">処理中...</span>
                </div>
            </div>

            <!-- 完了メッセージ -->
            <div id="resultSection" class="result-section" style="display: none;">
                <div class="success">完了しました！</div>
                <div class="result-preview">
                    <video id="resultVideo" class="preview" controls></video>
                </div>
                <div class="result-actions">
                    <button id="downloadBtn" class="btn output-btn">
                        <span class="icon">💾</span>
                        <span>ダウンロード</span>
                    </button>
                    <button id="newVideoBtn" class="btn select-btn">
                        <span class="icon">🔄</span>
                        <span>新しい動画を作成</span>
                    </button>
                </div>
            </div>
        </div>

        <footer class="footer">
            <span>Powered by FFmpeg.wasm</span>
        </footer>
    </div>

    <script src="https://unpkg.com/@ffmpeg/ffmpeg@0.11.6/dist/ffmpeg.min.js"></script>
    <script src="app.js"></script>
</body>
</html>
